<!-- 


 _ __  __
(_|  \/  | __ _ _ __ ___
| | |\/| |/ _` | '__/ __|
| | |  | | (_| | | | (__
|_|_|  |_|\__,_|_|  \___|


Coded and designed by Marc Wickens. Powered by 11ty.

-->



<!DOCTYPE html>
<html lang="en" class="theme-default">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>
      iMarc
      
    </title>
    

    <link rel="stylesheet" href="/static/css/site.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="crossorigin"/>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;500;600&family=Fira+Mono:wght@400;500&display=swap" rel="stylesheet"/>

    <link rel="icon" type="image/png" href="/imarc-icon.png">
    <link rel="apple-touch-icon" href="/imarc-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/imarc-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/imarc-icon.png">
    <link rel="alternate" type="application/rss+xml" href="/feed/index.xml" title="iMarc RSS">
    <link rel="canonical" href="https://www.imarc.co.uk/search/">

  </head>
  <body>
    <header class="site-header">
      <div class="inner">
        <a class="site-title" href="/">iMarc</a>
        <p class="tagline">thoughts on tech • by Marc Wickens</p>

        <nav class="site-nav">
          <a href="/">Home</a>
          <a href="/gear/">Gear</a>
          <a href="/archive/">Archive</a>
          <a href="/projects">Projects</a>
          <a href="http://marc.wickens.org.uk">About</a>

          <!-- <a href="https://mandiandmarc.wickens.uk/">Wedding</a> -->

          <form class="site-search" action="/search/" method="get">
            <label for="search-input" class="visually-hidden">Search</label>
            <input id="search-input" name="q" type="search" placeholder="Search…"/>
          </form>

        </nav>
      </div>
    </header>

    <main class="content inner">
      <h1>Search Results</h1>
<div id="search-results">
  <p>Type a query above to search.</p>
</div>








<script>
(async () => {
  const res = await fetch("/search/index.json", { cache: "no-store" });
  const posts = await res.json();

  const input = document.getElementById("search-input");
  const results = document.getElementById("search-results");

  const norm = s => (s||"")
    .toLowerCase()
    .normalize("NFD").replace(/\p{Diacritic}/gu,"")
    .replace(/[^a-z0-9\s]/g," ")
    .replace(/\s+/g," ")
    .trim();

  const escaped = s => (s||"").toString().replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  const reEsc = s => s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");

  // Precompute normalised fields
  const idx = posts.map(p => ({
    ...p,
    titleN: norm(p.title),
    excerptN: norm(p.excerpt)
  }));

  function parseQuery(qRaw){
    const phrases = [];
    qRaw = qRaw.replace(/"([^"]+)"/g, (_,ph) => { phrases.push(norm(ph)); return " "; });
    const terms = [...new Set(norm(qRaw).split(" ").filter(Boolean))];
    return { phrases, terms };
  }

  function score(doc, q){
    let s = 0;

    // Require all terms somewhere (order-free)
    if (!q.terms.every(t => doc.titleN.includes(t) || doc.excerptN.includes(t))) return 0;

    // Phrase boosts
    for (const ph of q.phrases){
      if (ph && doc.titleN.includes(ph)) s += 8;
      else if (ph && doc.excerptN.includes(ph)) s += 4;
    }
    // Term weights
    for (const t of q.terms){
      if (doc.titleN.includes(t)) s += 3;
      if (doc.excerptN.includes(t)) s += 1;
    }
    return s;
  }

  function highlight(html, terms){
    const toks = terms.filter(Boolean).map(reEsc);
    if (!toks.length) return html;
    const re = new RegExp(`\\b(${toks.join("|")})\\b`, "gi");
    return html.replace(re, "<mark>$1</mark>");
  }

  function run(qRaw){
    const q = parseQuery(qRaw);
    if (!q.terms.length && !q.phrases.length){
      results.innerHTML = "<p>Type a query above to search.</p>";
      return;
    }
    const matches = idx
      .map(d => ({ d, s: score(d, q) }))
      .filter(x => x.s > 0)
      .sort((a,b) => b.s - a.s)   // by score, then leave date order as-is
      .map(x => x.d);

    if (!matches.length){
      results.innerHTML = "<p>No results found.</p>";
      return;
    }

    results.innerHTML =
      "<ul>" + matches.map(p => {
        const titleH = highlight(escaped(p.title), q.terms);
        const excerptH = highlight(escaped(p.excerpt), q.terms);
        return `<li><a href="${escaped(p.url)}">${titleH}</a><br><small>${excerptH}</small></li>`;
      }).join("") + "</ul>";
  }

  input?.addEventListener("input", () => run(input.value));
  const params = new URLSearchParams(location.search);
  if (params.has("q")) { input.value = params.get("q"); run(input.value); }
})();
</script>
    </main>

    <footer class="site-footer">
      <div class="inner">
        <p>&copy; 2000 –
          2026
          Marc Wickens.
        </p>
      </div>
    </footer>

    <script src="/static/js/compare.js" defer="defer"></script>
    <script data-goatcounter="https://imarc.goatcounter.com/count" async="async" src="//gc.zgo.at/count.js"></script>

  </body>
</html>