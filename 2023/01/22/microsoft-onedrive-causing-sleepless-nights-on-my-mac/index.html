<!-- 


 _ __  __
(_|  \/  | __ _ _ __ ___
| | |\/| |/ _` | '__/ __|
| | |  | | (_| | | | (__
|_|_|  |_|\__,_|_|  \___|


Coded and designed by Marc Wickens. Powered by 11ty.

-->



<!DOCTYPE html>
<html lang="en" class="theme-default">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>
      Microsoft OneDrive Causing Sleepless Nights (on My Mac)
        ·
        iMarc
      
    </title>
    

    <link rel="stylesheet" href="/static/css/site.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="crossorigin"/>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;500;600&family=Fira+Mono:wght@400;500&display=swap" rel="stylesheet"/>

    <link rel="icon" type="image/png" href="/imarc-icon.png">
    <link rel="apple-touch-icon" href="/imarc-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/imarc-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/imarc-icon.png">
    <link rel="alternate" type="application/rss+xml" href="/feed/index.xml" title="iMarc RSS">
    <link rel="canonical" href="https://www.imarc.co.uk/2023/01/22/microsoft-onedrive-causing-sleepless-nights-on-my-mac/">

  </head>
  <body>
    <header class="site-header">
      <div class="inner">
        <a class="site-title" href="/">iMarc</a>
        <p class="tagline">thoughts on tech • by Marc Wickens</p>

        <nav class="site-nav">
          <a href="/">Home</a>
          <a href="/gear/">Gear</a>
          <a href="/archive/">Archive</a>
          <a href="/projects">Projects</a>
          <a href="http://marc.wickens.org.uk">About</a>

          <!-- <a href="https://mandiandmarc.wickens.uk/">Wedding</a> -->

          <form class="site-search" action="/search/" method="get">
            <label for="search-input" class="visually-hidden">Search</label>
            <input id="search-input" name="q" type="search" placeholder="Search…"/>
          </form>

        </nav>
      </div>
    </header>

    <main class="content inner">
      <article>
  <h1>Microsoft OneDrive Causing Sleepless Nights (on My Mac)</h1>
  <p class="meta">22 Jan 2023</p>
  <p><img src="/wp-content/uploads/2023/01/laptop_sleep.jpg?w=1024" alt=""></p>
<p>My M1 Mac mini has been sleeping dreadfully recently. Perhaps it's the thought of one day having <a href="https://mjtsai.com/blog/2022/12/27/ventura-issues/">macOS Ventura</a> installed on it, or the knowledge that its younger <a href="https://www.apple.com/uk/newsroom/2023/01/apple-introduces-new-mac-mini-with-m2-and-m2-pro-more-powerful-capable-and-versatile-than-ever/">M2 brethren</a> beats it in both <a href="https://www.tomsguide.com/news/mac-mini-m2-pro-first-benchmark-scores-are-in-this-is-big">performance</a> and <a href="https://twitter.com/felix_schwarz/status/1616365408356818945">power efficiency.</a> Or perhaps, it was something else altogether.</p>
<p>I could tell it wasn't sleeping due to the fact the attached USB storage would endlessly spin up and back down during the day; the Mac min sits under my desk while I work all day on my laptop. One time while it was supposedly asleep and idle, I went to plug a device into it, and could feel the fan blowing out hot air from the back. It wasn't sleeping at all.</p>
<p>Thanks to an app called <a href="https://ohanaware.com/sleepaid/">Sleep Aid</a>, I was able to verify that my Mac was indeed struggling to get to sleep. Even when I put it to sleep manually, it would quickly wake up and not go back to sleep again. Sleep Aid helpfully lists the processes that were active during time awake. In my case, the most active process was something called &quot;<strong>com.apple.FileProvider.cache-delete.push</strong>&quot;.</p>
<p>Armed with this information, I did what any self proclaimed nerd would do; I Googled it. To my surprise, there were barely any hits. Some posts relating to Android, <a href="https://developer.apple.com/forums/thread/715229">one</a> on the Apple Developer forum about a bug with the File Provider API, but it didn't seem related. I was stumped. Sam Rowlands, the developer behind Sleep Aid reached out to me on Twitter and offered to check that Sleep Aid itself wasn't misreporting what I was seeing. It was not.</p>
<p>Eventually I stumbled across a WWDC video on the File Provider API, and decided to watch it. It dawned on me that this is the API Apple makes for services such as Dropbox and Microsoft OneDrive to use. For years, Dropbox and OneDrive have been using various unofficial hacks in order to integrate with the Finder. In 2019, Apple released the File Provider API and <a href="https://help.dropbox.com/installs/macos-faqs">gradually</a> the third party cloud sync providers have been moving to it ever since.</p>
<p>Apart from Apple's own iCloud Drive, I only had Microsoft OneDrive installed. <strong>I promptly deleted the OneDrive app and since then, my Mac has not had any bouts of insomnia due to com.apple.FileProvider.cache-delete.push</strong>. Problem solved.</p>
<p>My guess is that because I had OneDrive set <strong>not</strong> to run on system startup, and I had the OneDrive sync directory on an external hard drive, somehow the push notifications that Apple sends to indicate a file has changed were getting stuck. Perhaps OneDrive is supposed to say &quot;I've got the file, you can go back to sleep&quot; but wasn't able to do so.</p>
<p>My Mac still spends a lot of the time it is supposed to be sleeping awake, but this seems to be common in M1 Macs. Thankfully now it does go to sleep for around 40% of the time instead of 0%, helping avoid needlessly wasting energy.</p>
<p>So if you've got a Mac that won't sleep, I recommend grabbing a copy of Sleep Aid to help find the culprit.</p>
<p><em>Title image generated by Stable Diffusion using the prompt &quot;a man sitting at a laptop falling asleep in a dark room at night, Cinematic&quot; (with some edits).</em></p>

  
</article>
    </main>

    <footer class="site-footer">
      <div class="inner">
        <p>&copy; 2000 –
          2025
          Marc Wickens.
        </p>
      </div>
    </footer>

    <script src="/static/js/compare.js" defer="defer"></script>
    <script data-goatcounter="https://imarc.goatcounter.com/count" async="async" src="//gc.zgo.at/count.js"></script>

  </body>
</html>